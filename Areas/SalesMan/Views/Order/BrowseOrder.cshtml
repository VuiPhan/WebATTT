@model Web.Models.ViewModels.OrderVM
@{
    ViewBag.Title = "BrowseOrder";
    Layout = "~/Areas/SalesMan/Views/Shared/_Layout.cshtml";
}
@*<link href="~/Content/bootstrap.min.css" rel="stylesheet" />*@
<script src="~/Scripts/bootbox.min.js"></script>
<link href="~/Scripts/ThanhGiaoHang.css" rel="stylesheet" />
<script src="~/Scripts/bootstrap.min.js"></script>
<br />
<br />
<style>
    example1 {
        border: 1px solid;
        padding: 10px;
        box-shadow: 5px 10px;
    }
</style>
<div id="DivIdToPrint">
    <div style="background-color:white;" class="example1">
        <div class="row shop-tracking-status col-md-12" style="position:center!important;margin-left:4px;background-color:azure;">
            <br />
            <div class="col-md-12">
                <div class="well">
                    <div class="order-status">
                        <div class="order-status-timeline">
                            <!-- class names: c0 c1 c2 c3 and c4 -->
                            <div id="changeStatus" class="order-status-timeline-completion"></div>
                        </div>
                        <div class="image-order-status image-order-status-new active img-circle">
                            <span class="status">Ngày đặt hàng</span>
                            <span class="status" style="margin-top:20px; margin-left:10px;">@Model.OrderedDate</span>

                            <div class="icon"></div>
                        </div>
                        <div class="image-order-status image-order-status-active active img-circle">
                            <span class="status">Ngày xác nhận</span>
                            <span class="status" style="margin-top:20px;">@Model.ConfirmDate</span>
                            <div class="icon"></div>
                        </div>
                        <div class="image-order-status image-order-status-intransit active img-circle">
                            <span class="status">Giao cho ĐVVC</span>
                            <span class="status" style="margin-top:20px;margin-left:20px;margin-right:-3px;">@Model.DeliveryDate</span>
                            <div class="icon"></div>
                        </div>
                        <div class="image-order-status image-order-status-delivered active img-circle">
                            <span class="status">Ngày giao hàng</span>
                            <span class="status" style="margin-top:20px;">@Model.DeliveredDate</span>
                            <div class="icon"></div>
                        </div>
                        <div class="image-order-status image-order-status-completed active img-circle">
                            <span class="status">Hoàn thành </span>
                            <div class="icon"></div>
                        </div>

                    </div>
                </div>
            </div>
        </div>
        <section class="order_details section_gap">
            <div class="container">
                <div class="row order_d_inner">
                    <div class="col-lg-6">
                        <div class="details_item">

                            <h4>Thông tin đơn hàng</h4>
                            <ul class="list">
                                <li><a style="pointer-events: none;" href="#"><span>Mã hóa đơn</span> : @Model.IDOrder</a></li>
                                <li><a style="pointer-events: none;" href="#"><span>Ngày đặt hàng</span> : @Model.OrderedDate</a></li>
                                <li><a style="pointer-events: none;" href="#"><span>Ngày xác nhận</span> : @Model.ConfirmDate</a></li>
                                <li><a style="pointer-events: none;" href="#"><span>Đã giao cho ĐVVC</span> : @Model.DeliveryDate</a></li>
                                <li><a style="pointer-events: none;" href="#"><span>Đơn hàng đã giao</span> : @Model.DeliveredDate</a></li>
                                <li><a style="pointer-events: none;" href="#"><span>Tổng cộng</span> : @String.Format(System.Globalization.CultureInfo.GetCultureInfo("vi-VN"), "{0:N0}", Model.TotalMoney) ₫</a></li>
                                <li><a style="pointer-events: none;" href="#"><span>Tình trạng</span> : @Model.Status</a></li>


                            </ul>

                            <script>
                        var model = @Html.Raw(Json.Encode(Model));
                        var s = @Html.Raw(Json.Encode(Model.Status));

                       if (s == "Chưa xác nhận") {
                            $("#changeStatus").addClass("c1");
                        }
                        if (s == "Chờ lấy hàng") {
                            $("#changeStatus").addClass("c2");
                        }
                        if (s == "Đang giao") {
                            $("#changeStatus").addClass("c3");
                        }
                        if (s == "Đã giao thành công") {
                            $("#changeStatus").addClass("c4");
                        }
                            </script>
                        </div>
                    </div>
                    <br />
                    <div class="col-lg-6">
                        <div class="details_item">
                            <h4>Thông tin người đặt</h4>
                            <ul class="list">
                                <li><a style="pointer-events: none;" href="#"><span>Tên</span> : @Model.FullName</a></li>
                                <li><a style="pointer-events: none;" href="#"><span>Email</span> : @Model.Email</a></li>
                                @*<li><a style="pointer-events: none;" href="#"><span>Địa chỉ</span> : @Model.Address </a></li>*@
                                @*<li><a style="pointer-events: none;" href="#">  </a></li>*@
                                <li><a style="pointer-events: none;" href="#"><span>Số điện thoại</span> :@Model.PhoneNumber</a></li>
                            </ul>
                        </div>

                    </div>

                </div>
                <div>
                    <p style="display:inline-block;color:blue; margin-right:4px;"> ***  Địa chỉ: *** </p> <input id="address" type="text" class="form-control form-control-lg" style="border-color:orange;width:300px; display:inline-block;" value="@Model.Address" />
                    @if (@Model.Status == "Đã hủy" || @Model.Status == "Trả hàng/ hoàn tiền")
                    {

                    }
                    else
                    {
                        <button class="btn btn-success" id="btn-Update" data-id="@Model.IDOrder">Cập nhật địa chỉ giao hàng</button>
                    }

                </div>
                <div class="order_details_table">
                    <h2>Chi tiết đơn hàng</h2>
                    <div class="table-responsive">
                        <table class="table">
                            <thead>
                                <tr>
                                    <th scope="col">Sản phẩm</th>
                                    <th scope="col">Đơn giá</th>
                                    <th scope="col">Số lượng</th>
                                    <th scope="col">Tổng tiền</th>
                                </tr>
                            </thead>
                            <tbody>
                                @foreach (var item in Model.carts)
                                {
                                    <tr>
                                        <td>
                                            <p>@item.NameProduct</p>
                                        </td>
                                        <td>
                                            <p>@String.Format(System.Globalization.CultureInfo.GetCultureInfo("vi-VN"), "{0:N0}", item.Price) ₫</p>
                                        </td>
                                        <td>
                                            <h5>x @item.Amount</h5>
                                        </td>
                                        <td>
                                            <p>@String.Format(System.Globalization.CultureInfo.GetCultureInfo("vi-VN"), "{0:N0}", item.TotalMoney) ₫</p>
                                        </td>
                                    </tr>
                                }
                                <tr>
                                    <td>
                                        <h4>Tổng cộng</h4>
                                    </td>
                                    <td>
                                        <h5></h5>
                                    </td>
                                    <td></td>
                                    <td>
                                        <p>@String.Format(System.Globalization.CultureInfo.GetCultureInfo("vi-VN"), "{0:N0}", Model.TotalMoney) ₫</p>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </section>
    </div>
</div>
<br />
<br />
<div style="margin-bottom:30px;margin-left:500px;" class="col-md-10">
    @*<input type="submit" value="In đơn hàng" id="btnInDonHang" class="btn btn-primary" />*@
    <input type='button' id='btn' value='In đơn hàng' onclick='printDiv();' class="btn btn-primary">

    @*<input type="submit" value="Lưu đơn hàng" id="btnLuuDonHang" class="btn btn-success" />*@
</div>
<script>

    $('#btn-Update').off('click').on('click', function () {
        //bootbox.alert("This is the default alert!");

        var id = $(this).data('id');
        const status = $(this).data('status');
        var address = $('#address').val();
        bootbox.confirm("Bạn muốn thay đổi địa chỉ đơn hàng này?", function (result) {
            if (result)
                $.ajax({
                    url: '/SalesMan/Order/UpdateAddressOrder',
                    data: {
                        id: id,
                        address: address
                    },
                    type: 'POST',
                    dataType: 'json',
                    success: function (response) {
                        if (response.status == true) {
                            bootbox.alert("Đã cập nhật địa chỉ thành công!!!", function () {
                                //location.reload();
                                //    document.getElementById("statusOrder").innerHTML = "Đã hủy";
                                //   $("#btn-Delete").hide();
                                //  $("#message").show();
                            });
                        }
                        else {
                            bootbox.alert(response.mess);
                        }
                    },
                    error: function (err) {
                        console.log(err);

                    }
                });
        });

    });
</script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/1.5.3/jspdf.debug.js" integrity="sha384-NaWTHo/8YCBYJ59830LTz/P4aQZK1sS0SneOgAvhsIl3zBu8r9RevNg5lHCHAuQ/" crossorigin="anonymous"></script>

<script>
    function printDiv() {

        var divToPrint = document.getElementById('DivIdToPrint');

        var newWin = window.open('', 'Print-Window');

        newWin.document.open();

        newWin.document.write('<html><body onload="window.print()">' + divToPrint.innerHTML + '</body></html>');

        newWin.document.close();

        setTimeout(function () { newWin.close(); }, 10);

    }
</script>


